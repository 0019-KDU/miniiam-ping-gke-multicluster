# =============================================================================
# PingDirectory Multi-Region Values - GKE Europe (Non-Seed Cluster)
# Industry Best Practice: LoadBalancer per Pod + LDAP Port Exclusion
# =============================================================================

# -----------------------------------------------------------------------------
# Global Configuration
# -----------------------------------------------------------------------------
global:
  addReleaseNameToResource: none

  envs:
    PING_IDENTITY_ACCEPT_EULA: "YES"

  secretEnvs:
    - secretRef:
        name: devops-secret

  image:
    repository: pingidentity
    pullPolicy: IfNotPresent
    tag: "2512"

  ingress:
    enabled: false

  labels:
    app.kubernetes.io/part-of: ping-iam

# -----------------------------------------------------------------------------
# PingDirectory - LDAP User Store with Multi-Region Replication
# -----------------------------------------------------------------------------
pingdirectory:
  enabled: true
  name: pingdirectory

  workload:
    type: StatefulSet
    # Istio sidecar annotations - KEEP sidecar but EXCLUDE LDAP ports
    annotations:
      sidecar.istio.io/inject: "true"
      # Exclude LDAP ports from Istio proxy interception (industry best practice)
      traffic.sidecar.istio.io/excludeOutboundPorts: "1389,1636,8989"
      traffic.sidecar.istio.io/excludeInboundPorts: "1389,1636,8989"

  container:
    replicaCount: 1
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: 2
        memory: 2Gi

  # Multi-Region Replication Environment Variables
  envs:
    ROOT_USER_DN: "cn=administrator"
    ROOT_USER_PASSWORD: "2FederateM0re"
    USER_BASE_DN: "dc=example,dc=com"
    MAX_HEAP_SIZE: "768m"
    # Unique instance name for this cluster (required for replication)
    PD_CLUSTER_NAME: "gke-europe"
    # Override hostname for unique instance name in replication topology
    HOSTNAME: "pingdirectory-europe"
    # Multi-cluster replication configuration
    K8S_CLUSTERS: "gke-asia,gke-europe"
    K8S_CLUSTER: "gke-europe"
    K8S_SEED_CLUSTER: "gke-asia"
    # Hostname pattern for cross-cluster DNS
    K8S_POD_HOSTNAME_PREFIX: "pingdirectory-"
    K8S_POD_HOSTNAME_SUFFIX: ".ping-iam.svc.cluster.local"
    # Replication ports
    REPLICATION_PORT: "8989"
    LDAPS_PORT: "1636"
    LDAP_PORT: "1389"

  services:
    # Name ports with tcp- prefix for explicit Istio TCP handling
    ldap:
      servicePort: 1389
      containerPort: 1389
      dataService: true
    ldaps:
      servicePort: 1636
      containerPort: 1636
      dataService: true
    https:
      servicePort: 1443
      containerPort: 1443
      dataService: true
    # Replication service
    replication:
      servicePort: 8989
      containerPort: 8989
      clusterService: true

  persistentvolume:
    enabled: true
    volumes:
      out:
        mountPath: /opt/out
        persistentVolumeClaim:
          accessModes:
            - ReadWriteOnce
          storageClassName: standard-rwo
          resources:
            requests:
              storage: 5Gi

# -----------------------------------------------------------------------------
# Disable other components (they use base values)
# -----------------------------------------------------------------------------
pingfederate-admin:
  enabled: false

pingfederate-engine:
  enabled: false

pingaccess-admin:
  enabled: false

pingaccess-engine:
  enabled: false
